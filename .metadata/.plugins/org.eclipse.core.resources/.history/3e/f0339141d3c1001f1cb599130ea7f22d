<%@page import="com.kh.dev.join.model.BoardTwoVO"%>
<%@page import="com.kh.dev.join.model.BoardTwoDAO"%>
<%@page import="java.sql.Timestamp"%>
<%@ page contentType="text/html; charset=UTF-8" %>
<%
    try {
        request.setCharacterEncoding("utf-8");

        String writer = request.getParameter("writer");
        String subject = request.getParameter("subject");
        String content = request.getParameter("content");
        String email = request.getParameter("email");
        String pass = request.getParameter("pass");

        // 데이터 검증
        if (writer == null || writer.trim().isEmpty() ||
            subject == null || subject.trim().isEmpty() ||
            content == null || content.trim().isEmpty() ||
            email == null || email.trim().isEmpty() ||
            pass == null || pass.trim().isEmpty()) {
            throw new IllegalArgumentException("모든 필드를 입력해야 합니다.");
        }

        // 데이터베이스 처리
        BoardTwoVO vo = new BoardTwoVO();
        vo.setWriter(writer.trim());
        vo.setSubject(subject.trim());
        vo.setContent(content.trim());
        vo.setEmail(email.trim());
        vo.setPass(pass.trim());

        BoardTwoDAO dao = BoardTwoDAO.getInstance();
        boolean isInserted = dao.insertDB(vo);

        if (isInserted) {
            // 세션에 데이터 저장
            session.setAttribute("writer", writer.trim());
            session.setAttribute("subject", subject.trim());
            session.setAttribute("content", content.trim());
            session.setAttribute("email", email.trim());
            response.sendRedirect("updateForm.jsp");
        } else {
            out.println("<script>alert('글 등록 실패'); history.back();</script>");
        }
    } catch (Exception e) {
        e.printStackTrace();
        out.println("<script>alert('오류 발생: " + e.getMessage() + "'); history.back();</script>");
    }
%>
