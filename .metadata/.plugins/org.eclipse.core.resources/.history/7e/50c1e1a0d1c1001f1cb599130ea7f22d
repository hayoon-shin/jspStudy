<%@page import="com.kh.dev.join.model.BoardTwoDAO"%>
<%@ page contentType="text/html; charset=UTF-8" %>
<%
    try {
        request.setCharacterEncoding("utf-8");

        String writer = request.getParameter("writer");
        String subject = request.getParameter("subject");
        String content = request.getParameter("content");
        String email = request.getParameter("email");
        String pass = request.getParameter("pass");
        String numStr = request.getParameter("num");

        if (writer == null || writer.trim().isEmpty() ||
            subject == null || subject.trim().isEmpty() ||
            content == null || content.trim().isEmpty() ||
            email == null || email.trim().isEmpty() ||
            pass == null || pass.trim().isEmpty() ||
            numStr == null || numStr.trim().isEmpty()) {
            throw new IllegalArgumentException("모든 필드를 입력해야 합니다.");
        }

        int num = Integer.parseInt(numStr.trim());

        // DAO 호출
        BoardTwoVO vo = new BoardTwoVO();
        vo.setWriter(writer.trim());
        vo.setSubject(subject.trim());
        vo.setContent(content.trim());
        vo.setEmail(email.trim());
        vo.setPass(pass.trim());
        vo.setNum(num);

        BoardTwoDAO dao = BoardTwoDAO.getInstance();
        boolean isUpdated = dao.updateDB(vo);

        if (isUpdated) {
            // 세션 초기화
            session.removeAttribute("writer");
            session.removeAttribute("subject");
            session.removeAttribute("content");
            session.removeAttribute("email");

            out.println("<script>alert('글이 수정되었습니다.'); location.href='list.jsp';</script>");
        } else {
            out.println("<script>alert('비밀번호가 일치하지 않거나 수정할 수 없습니다.'); history.back();</script>");
        }
    } catch (Exception e) {
        e.printStackTrace();
        out.println("<script>alert('오류 발생: " + e.getMessage() + "'); history.back();</script>");
    }
%>
